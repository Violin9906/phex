<!doctype html>
<html>
<head>
<title>中国滑稽大学大物实验数据处理系统</title>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<!-- 新 Bootstrap 核心 CSS 文件 -->
<link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
 
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
 
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

<!-- angular js -->
<script src="https://cdn.staticfile.org/angular.js/1.4.6/angular.min.js"></script>

<!-- handsontable -->
<script src="../lib/js/handsontable.full.min.js"></script>
<link href="../lib/css/handsontable.full.min.css" rel="stylesheet" media="screen">
<script src="../lib/js/formula.min.js"></script>

<!-- MathJax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<link href="../lib/css/style.css" rel="stylesheet" type='text/css' />
<link rel="icon" href="../pic/logo.png" />
<link rel="shortcut icon" href="../pic/logo.png" />
</head>
<body ng-app="">


<div class="container">
	<div class="row clearfix">
		<div class="col-md-12 column">
			<header>
				<center><img src='../pic/logo-white.png' height='200px' width='230px'/ style="margin:30px"><h1><span style="color:#fff">中国滑稽大学大物实验数据处理系统</span></h1></center>
			</header>
			<nav>
				<ul class="nav nav-tabs">
					<li>
						<a href="../index.html">首页</a>
					</li>
					<li class="dropdown active">
						<a href="#" data-toggle="dropdown" class="dropdown-toggle">不确定度分析<strong class="caret"></strong></a>
						<ul class="dropdown-menu">
							<li>
								<a href="./singlevar.html">单变量不确定度分析</a>
							</li>
						</ul>
					</li>
					<li class="dropdown">
						<a href="#" data-toggle="dropdown" class="dropdown-toggle">回归分析<strong class="caret"></strong></a>
						<ul class="dropdown-menu">
							<li>
								<a href="../regression/liner.html">线性回归</a>
							</li>
						</ul>
					</li>
					<li>
						<a href="../calc/" data-toggle="dropdown" class="dropdown-toggle">统计分析</a>
					</li>
					<li class="dropdown">
						<a href="#" data-toggle="dropdown" class="dropdown-toggle">大雾百科<strong class="caret"></strong></a>
						<ul class="dropdown-menu">
							<li>
								<a href="../pedia/tables.html">物理学常用表</a>
							</li>
						</ul>
					</li>
				</ul>
			</nav>
		
			<div class="jumbotron">
<!-- article -->
				<article>
					<h2><center>单变量不确定度分析</center></h2>
					<form class="form-horizontal" role="form">
						<div class="form-group">
							<label for="data_n" class="col-sm-2 control-label" style="margin:-4px">数据组数</label>
							<div class="col-sm-2">
								<input type="number" min="3" class="form-control" id="data_n" name="data_n"/>
							</div>
						</div>
						<div class="form-group">
							<label for="data_p" class="col-sm-2 control-label" style="margin:-4px">置信概率P</label>
							<div class="col-sm-2">
								<input type="text" list="data_p_list" name="data_p" id="data_p" class="form-control" />
								<datalist id="data_p_list"><option value="0.95">0.95</option><option value="0.68">0.68</option><option value="0.90">0.90</option><option value="0.99">0.99</option></datalist>
							</div>
						</div>
						<div class="form-group">
							<label for="data_c" class="col-sm-2 control-label" style="margin:-4px">置信系数C</label>
							<div class="col-sm-2">
								<input type="text" class="form-control" list="data_c_list" name="data_c" id="data_c">
								<datalist id="data_c_list"><option label="正态分布" value="3" /><option label="均匀分布" value="1.73205080757" /><option label="三角分布" value="2.44948974278" /></datalist>
							</div>
						</div>
						<div class="form-group">
							<label for="data_t" class="col-sm-2 control-label" style="margin:-4px">t因子</label>
							<div class="col-sm-2">
								<input type="number" class="form-control" name="data_t" id="data_t">
							</div>
						</div>
						<div class="form-group">
							<label for="data_deltab" class="col-sm-2 control-label" style="margin:-4px">测量误差</label>
							<div class="col-sm-2">
								<input type="number" class="form-control" name="data_deltab" id="data_deltab">
							</div>
						</div>
						<div class="form-group">
							<label for="data_kp" class="col-sm-2 control-label" style="margin:-4px">置信因子kp</label>
							<div class="col-sm-2">
								<input type="number" class="form-control" name="data_kp" id="data_kp">
							</div>
						</div>
					</form>
					<div id="datatab" style="position:relative; height:auto; overflow:auto;"></div>
					<button onClick="calculate()" class="btn btn-success"><span class="glyphicon glyphicon-list">&nbsp;开始分析</span></button>
					<div id="report" style="position:relative; height:auto; overflow:auto;"></div>




				</article>
				<script type="text/javascript">
					var data = new Array(document.getElementById("data_n").value);
					for(var i=0;i<document.getElementById("data_n").value;i++){
						data[i]=[''];
					}
					var array_t={
						"0.68":['','','',1.32,1.20,1.14,1.11,1.09,1.08,1.07,1.06,'','','','',1.04,'','','','',1.03],
						"0.90":['','','',2.92,2.35,2.13,2.02,1.94,1.86,1.83,1.76,'','','','',1.73,'','','','',1.71],
						"0.95":['','','',4.30,3.18,2.78,2.57,2.46,2.37,2.31,2.26,'','','','',2.15,'','','','',2.09],
						"0.99":['','','',9.93,5.84,4.60,4.03,3.71,3.50,3.36,3.25,'','','','',2.98,'','','','',2.86]
					};
					var array_kp={
						"0.68":{"3":1,"1.73205080757":1.183,"2.44948974278":1.064},
						"0.90":{"3":1.65,"1.73205080757":1.559,"2.44948974278":1.675},
						"0.95":{"3":1.96,"1.73205080757":1.645,"2.44948974278":1.901},
						"0.99":{"3":2.58,"1.73205080757":1.715,"2.44948974278":2.204},
					};

					console.log(array_t);
    				document.getElementById("data_n").onchange=function(){
    					data = new Array(document.getElementById("data_n").value);
						for(var i=0;i<document.getElementById("data_n").value;i++){
							data[i]=[''];
						}
						
						var container = document.getElementById('datatab');
						document.getElementById('datatab').innerHTML='';
						var hot = new Handsontable(container, {
  							data: data,
  							colWidths: 200,
  							rowHeaders: true,
  							colHeaders: true,
  							filters: false,
  							dropdownMenu: false,
  							formula: false
						});

						var idObject = document.getElementById("hot-display-license-info");
        				while(idObject!=null){
            				idObject.parentNode.removeChild(idObject);
            				idObject = document.getElementById("hot-display-license-info");
        				}

        				document.getElementById("data_t").value=array_t[document.getElementById("data_p").value][document.getElementById("data_n").value];
    				}

    				
    				document.getElementById("data_p").onchange=function(){
    					document.getElementById("data_t").value=array_t[document.getElementById("data_p").value][document.getElementById("data_n").value];
    					document.getElementById("data_kp").value=array_kp[document.getElementById("data_p").value][document.getElementById("data_c").value];
    				}
    				document.getElementById("data_c").onchange=function(){
    					document.getElementById("data_kp").value=array_kp[document.getElementById("data_p").value][document.getElementById("data_c").value];
    				}
    				function calculate(){
    					var n=parseFloat(document.getElementById("data_n").value);
						var deltab=parseFloat(document.getElementById("data_deltab").value);
						var c=parseFloat(document.getElementById("data_c").value);
						var kp=parseFloat(document.getElementById("data_kp").value);
						var t=parseFloat(document.getElementById("data_t").value);
						var i=0;
						var sum=0;
						for(i=0;i<n;i++){
							sum+=parseFloat(data[i][0]);
						}
						var average=sum/n;
						var deltasqr=0;
						for(i=0;i<n;i++){
							deltasqr+=Math.pow(data[i][0]-average,2);
						}
						var sigma=Math.sqrt(deltasqr/(n-1));
						var input="";
						
						document.getElementById("report").innerHTML='<p><center><strong><h2 style="font-family:Simsun;font-weight:1000;text-decoration:underline;">实   验   报   告</h2></strong></center></p>';
						document.getElementById("report").innerHTML+='<p style="text-align:center;font-family:Simsun;">___________系__________级  姓名_______________________  日期__________________  NO.______________<br /></p><hr />';
						var averageinfo=new String('<p>数据的平均值<br />$$ \\bar{x}=\\frac{1}{n}\\sum_{i=1}^{n}x_i=\\frac{1}{'+document.getElementById("data_n").value+'}\\lgroup');
						for(var i=0;i<n-1;i++){
							averageinfo+=data[i][0]+'+';
						}
						averageinfo+=data[i][0]+'\\rgroup='+String(average)+' $$</p>';
						document.getElementById("report").innerHTML+=averageinfo;

						var sigmainfo=new String('<p>数据的样本标准差<br />$$ \\sigma=\\sqrt{\\frac{\\sum_{i=1}^{n}\\lgroup x_i-\\bar{x}\\rgroup ^2}{n-1}}=')
						sigmainfo+=String(sigma)+'$$</p>';
						document.getElementById("report").innerHTML+=sigmainfo;

						var uainfo=new String('<p>数据的A类不确定度<br />$$ t_P u_A=\\frac{t_P \\sigma}{\\sqrt{n}}=')
						var tpua=t*sigma/Math.sqrt(n);
						uainfo+=String(tpua)+'$$</p>';
						document.getElementById("report").innerHTML+=uainfo;

						var ubinfo=new String('<p>数据的B类不确定度<br />$$ k_P u_B=k_P\\frac{\\Delta_{仪}}{C}=')
						var kpub=kp*deltab/c;
						ubinfo+=String(kpub)+'$$</p>';
						document.getElementById("report").innerHTML+=ubinfo;

						var uuinfo=new String('<p>数据的合成展伸不确定度<br />$$ U_{'+document.getElementById("data_p").value+'}=\\sqrt{\\lgroup t_P u_A\\rgroup ^2+\\lgroup k_P u_B\\rgroup ^2}=')
						var uu=Math.sqrt(Math.pow(tpua,2)+Math.pow(kpub,2));
						uuinfo+=String(uu)+'$$</p>';
						document.getElementById("report").innerHTML+=uuinfo;

						var xinfo=new String('<p>数据的最终测量结果<br />$$ x='+String(average)+'\\quad\\pm\\quad'+String(uu)+'\\qquad P='+document.getElementById("data_p").value+'$$</p>')
						document.getElementById("report").innerHTML+=xinfo;

						MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
					}
    				
					
				</script>
<!-- /article -->
			</div>
				<footer>
					<div class="row clearfix" style="text-align:center;color:#fff;font-size:16px">
						<div class="col-md-3 column">
							<ul class="list-unstyled">
								<li>
									<a href="https://www.ustc.edu.cn/">中国科学技术大学</a>
								</li>
							</ul>
						</div>
						<div class="col-md-3 column">
							<ul class="list-unstyled">
								<li>
									<a href="http://jxzy.ustc.edu.cn/">中国科大物理实验教学中心</a>
								</li>
							</ul>
						</div>
						<div class="col-md-3 column">
							<ul class="list-unstyled">
								<li>
									<a href="http://ustcaaa.ml/">中国科大天文爱好者协会</a>
								</li>
							</ul>
						</div>
						<div class="col-md-3 column">
							<ul class="list-unstyled">
								<li>
									<a href="mailto:violinwang@mail.ustc.edu.cn">联系作者</a>
								</li>
							</ul>
						</div>
						<div class="col-md-12 column" style="text-align:center;color:#fff;font-size:16px;">
						</div>
					</div>
				</footer>
		</div>
	</div>
</div>
</body>
</html>